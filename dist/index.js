'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _web = require('web3');

var _web2 = _interopRequireDefault(_web);

var _mysql = require('mysql');

var _mysql2 = _interopRequireDefault(_mysql);

var _updateTokenInflationRate = require('./updateTokenInflationRate');

var _updateTokenInflationRate2 = _interopRequireDefault(_updateTokenInflationRate);

var _updateInflationRateAverage = require('./updateInflationRateAverage');

var _updateInflationRateAverage2 = _interopRequireDefault(_updateInflationRateAverage);

var _updateLeaderboard = require('./updateLeaderboard');

var _updateLeaderboard2 = _interopRequireDefault(_updateLeaderboard);

var _updateTotalSupply = require('./updateTotalSupply');

var _updateTotalSupply2 = _interopRequireDefault(_updateTotalSupply);

var _updateContributionFrequency = require('./updateContributionFrequency');

var _updateContributionFrequency2 = _interopRequireDefault(_updateContributionFrequency);

var _updateSummaryStatistics = require('./updateSummaryStatistics');

var _updateSummaryStatistics2 = _interopRequireDefault(_updateSummaryStatistics);

var _saveContributionEvent = require('./saveContributionEvent');

var _saveContributionEvent2 = _interopRequireDefault(_saveContributionEvent);

var _updateRewardTypeStats = require('./updateRewardTypeStats');

var _updateRewardTypeStats2 = _interopRequireDefault(_updateRewardTypeStats);

var _updateUserTokenCreation = require('./updateUserTokenCreation');

var _updateUserTokenCreation2 = _interopRequireDefault(_updateUserTokenCreation);

var _milestoneCreated = require('./milestoneCreated');

var _milestoneCreated2 = _interopRequireDefault(_milestoneCreated);

var _milestoneCompleted = require('./milestoneCompleted');

var _milestoneCompleted2 = _interopRequireDefault(_milestoneCompleted);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/* babel-plugin-inline-import 'gittoken-contracts/build/contracts/GitToken.json' */var GitTokenContract = '{\n  "contract_name": "GitToken",\n  "abi": [\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_initialPrice",\n          "type": "uint256"\n        },\n        {\n          "name": "_delay",\n          "type": "uint256"\n        },\n        {\n          "name": "_tokenLimitFactor",\n          "type": "uint256"\n        },\n        {\n          "name": "_lockTokens",\n          "type": "bool"\n        }\n      ],\n      "name": "initializeAuction",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [],\n      "name": "name",\n      "outputs": [\n        {\n          "name": "_name",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_spender",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "approve",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "totalSupply",\n      "outputs": [\n        {\n          "name": "_supply",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "getContributorAddress",\n      "outputs": [\n        {\n          "name": "_contributorAddress",\n          "type": "address"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_from",\n          "type": "address"\n        },\n        {\n          "name": "_to",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "transferFrom",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [],\n      "name": "organization",\n      "outputs": [\n        {\n          "name": "_organization",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "decimals",\n      "outputs": [\n        {\n          "name": "_decimals",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "getTokenLockUntilDate",\n      "outputs": [\n        {\n          "name": "_lockedUntil",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_contributorAddress",\n          "type": "address"\n        }\n      ],\n      "name": "getContributorUsername",\n      "outputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_rewardValue",\n          "type": "uint256"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "setRewardValue",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "",\n          "type": "address"\n        }\n      ],\n      "name": "owner",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_holder",\n          "type": "address"\n        }\n      ],\n      "name": "balanceOf",\n      "outputs": [\n        {\n          "name": "_balance",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "getUnclaimedRewards",\n      "outputs": [\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_rewardType",\n          "type": "string"\n        },\n        {\n          "name": "_reservedType",\n          "type": "string"\n        }\n      ],\n      "name": "getRewardDetails",\n      "outputs": [\n        {\n          "name": "_rewardValue",\n          "type": "uint256"\n        },\n        {\n          "name": "_reservedValue",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [],\n      "name": "symbol",\n      "outputs": [\n        {\n          "name": "_symbol",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_to",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "transfer",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_auctionRound",\n          "type": "uint256"\n        },\n        {\n          "name": "_exchangeRate",\n          "type": "uint256"\n        }\n      ],\n      "name": "executeBid",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": true,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_reservedValue",\n          "type": "uint256"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        },\n        {\n          "name": "_reservedType",\n          "type": "string"\n        }\n      ],\n      "name": "setReservedValue",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        },\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "verifyContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_owner",\n          "type": "address"\n        },\n        {\n          "name": "_spender",\n          "type": "address"\n        }\n      ],\n      "name": "allowance",\n      "outputs": [\n        {\n          "name": "_allowance",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        },\n        {\n          "name": "_reservedType",\n          "type": "string"\n        },\n        {\n          "name": "_rewardBonus",\n          "type": "uint256"\n        },\n        {\n          "name": "_deliveryID",\n          "type": "string"\n        }\n      ],\n      "name": "rewardContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "newOwner",\n          "type": "address"\n        }\n      ],\n      "name": "transferOwnership",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        },\n        {\n          "name": "_name",\n          "type": "string"\n        },\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_organization",\n          "type": "string"\n        },\n        {\n          "name": "_symbol",\n          "type": "string"\n        },\n        {\n          "name": "_decimals",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "constructor"\n    },\n    {\n      "payable": false,\n      "type": "fallback"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "owner",\n          "type": "address"\n        },\n        {\n          "indexed": true,\n          "name": "spender",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        }\n      ],\n      "name": "Approval",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "from",\n          "type": "address"\n        },\n        {\n          "indexed": true,\n          "name": "to",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        }\n      ],\n      "name": "Transfer",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "contributor",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "username",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "reservedValue",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "Contribution",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "contributor",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "username",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        }\n      ],\n      "name": "ContributorVerified",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": false,\n          "name": "rewardType",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "reservedType",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        }\n      ],\n      "name": "RewardValueSet",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": false,\n          "name": "auctionDetails",\n          "type": "uint256[8]"\n        }\n      ],\n      "name": "Auction",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": false,\n          "name": "bidDetails",\n          "type": "uint256[9]"\n        }\n      ],\n      "name": "AuctionBid",\n      "type": "event"\n    }\n  ],\n  "unlinked_binary": "0x606060405234156200001057600080fd5b60405162003dcb38038062003dcb83398101604052808051919060200180518201919060200180518201919060200180518201919060200180518201919060200180519150505b5b600160a060020a0333166000908152602081905260409020805460ff191660011790555b600160a060020a038616156200015457600160a060020a038616600090815260208181526040808320805460ff19166001179055600b9091529020848051620000ca92916020019062000ccd565b5085600c856040518082805190602001908083835b602083106200010157805182525b601f199092019160209182019101620000df565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040519081900390208054600160a060020a031916600160a060020a03929092169190911790555b600060015560038580516200016e92916020019062000ccd565b5060048380516200018492916020019062000ccd565b5060058280516200019a92916020019062000ccd565b5060028190556000600a6040517f6d696c6573746f6e6500000000000000000000000000000000000000000000008152600981019190915260290160405180910390206040517f63726561746564000000000000000000000000000000000000000000000000008152600781019190915260270160405180910390208190555080600a0a619c400260016009016040517f6d696c6573746f6e6500000000000000000000000000000000000000000000008152600981019190915260290160405180910390206040517f636c6f736564000000000000000000000000000000000000000000000000000081526006810191909152602601604051908190039020556000600a6040517f6f7267616e697a6174696f6e00000000000000000000000000000000000000008152600c810191909152602c0160405180910390206040517f6d656d6265725f696e76697465640000000000000000000000000000000000008152600e810191909152602e0160405180910390208190555080600a0a613a980260016009016040517f6f7267616e697a6174696f6e00000000000000000000000000000000000000008152600c810191909152602c0160405180910390206040517f6d656d6265725f616464656400000000000000000000000000000000000000008152600c810191909152602c01604051908190039020556109c4600a82900a0260096040517f70696e6700000000000000000000000000000000000000000000000000000000815260048101919091526024016040519081900390205560fa600a82900a0260096040517f636f6d6d69745f636f6d6d656e740000000000000000000000000000000000008152600e810191909152602e01604051908190039020556109c4600a82900a0260096040517f63726561746500000000000000000000000000000000000000000000000000008152600681019190915260260160405190819003902055600060096040517f64656c65746500000000000000000000000000000000000000000000000000008152600681019190915260260160405190819003902055611388600a82900a0260096040517f6465706c6f796d656e74000000000000000000000000000000000000000000008152600a810191909152602a01604051908190039020556064600a82900a0260096040517f6465706c6f796d656e745f7374617475730000000000000000000000000000008152601181019190915260310160405190819003902055611388600a82900a0260096040517f666f726b0000000000000000000000000000000000000000000000000000000081526004810191909152602401604051908190039020556064600a82900a0260096040517f676f6c6c756d0000000000000000000000000000000000000000000000000000815260068101919091526026016040519081900390205560fa600a82900a0260096040517f696e7374616c6c6174696f6e00000000000000000000000000000000000000008152600c810191909152602c01604051908190039020556103e8600a82900a0260096040517f696e7374616c6c6174696f6e5f7265706f7369746f7269657300000000000000815260198101919091526039016040519081900390205560fa600a82900a0260096040517f69737375655f636f6d6d656e74000000000000000000000000000000000000008152600d810191909152602d01604051908190039020556101f4600a82900a0260096040517f697373756573000000000000000000000000000000000000000000000000000081526006810191909152602601604051908190039020556064600a82900a0260096040517f6c6162656c0000000000000000000000000000000000000000000000000000008152600581019190915260250160405190819003902055600060096040517f6d61726b6574706c6163655f707572636861736573000000000000000000000081526015810191909152603501604051908190039020556103e8600a82900a0260096040517f6d656d626572000000000000000000000000000000000000000000000000000081526006810191909152602601604051908190039020556103e8600a82900a0260096040517f6d656d62657273686970000000000000000000000000000000000000000000008152600a810191909152602a016040519081900390205560fa600a82900a0260096040517f6d696c6573746f6e65000000000000000000000000000000000000000000000081526009810191909152602901604051908190039020556103e8600a82900a0260096040517f6f7267616e697a6174696f6e00000000000000000000000000000000000000008152600c810191909152602c0160405190819003902055600060096040517f6f72675f626c6f636b000000000000000000000000000000000000000000000081526009810191909152602901604051908190039020556101f4600a82900a0260096040517f706167655f6275696c64000000000000000000000000000000000000000000008152600a810191909152602a016040519081900390205560fa600a82900a0260096040517f70726f6a6563745f6361726400000000000000000000000000000000000000008152600c810191909152602c01604051908190039020556032600a82900a0260096040517f70726f6a6563745f636f6c756d6e0000000000000000000000000000000000008152600e810191909152602e01604051908190039020556103e8600a82900a0260096040517f70726f6a656374000000000000000000000000000000000000000000000000008152600781019190915260270160405190819003902055612710600a82900a0260096040517f7075626c69630000000000000000000000000000000000000000000000000000815260068101919091526026016040519081900390205560fa600a82900a0260096040517f70756c6c5f726571756573745f7265766965775f636f6d6d656e7400000000008152601b810191909152603b016040519081900390205560fa600a82900a0260096040517f70756c6c5f726571756573745f7265766965770000000000000000000000000081526013810191909152603301604051908190039020556109c4600a82900a0260096040517f70756c6c5f7265717565737400000000000000000000000000000000000000008152600c810191909152602c01604051908190039020556103e8600a82900a0260096040517f707573680000000000000000000000000000000000000000000000000000000081526004810191909152602401604051908190039020556109c4600a82900a0260096040517f7265706f7369746f7279000000000000000000000000000000000000000000008152600a810191909152602a0160405190819003902055611388600a82900a0260096040517f72656c6561736500000000000000000000000000000000000000000000000000815260078101919091526027016040519081900390205560c8600a82900a0260096040517f737461747573000000000000000000000000000000000000000000000000000081526006810191909152602601604051908190039020556107d0600a82900a0260096040517f7465616d0000000000000000000000000000000000000000000000000000000081526004810191909152602401604051908190039020556107d0600a82900a0260096040517f7465616d5f61646400000000000000000000000000000000000000000000000081526008810191909152602801604051908190039020556064600a82900a0260096040517f776174636800000000000000000000000000000000000000000000000000000081526005810191909152602501604051908190039020555b50505050505062000d77565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1062000d1057805160ff191683800117855562000d40565b8280016001018555821562000d40579182015b8281111562000d4057825182559160200191906001019062000d23565b5b5062000d4f92915062000d53565b5090565b62000d7491905b8082111562000d4f576000815560010162000d5a565b5090565b90565b6130448062000d876000396000f300606060405236156101305763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166302439dde811461014857806306fdde031461017d578063095ea7b31461020857806318160ddd1461023e5780631e923ded1461026357806323b872dd146102d057806323bd4d7a1461030c578063313ce5671461039757806355d67427146103bc57806355ded44d146103e157806366253c4414610478578063666e1b39146104e257806370a082311461051557806376500a7e1461054657806392956c1e146105a957806395d89b4114610654578063a9059cbb146106df578063a9c7c53614610715578063cdf25db314610737578063d85600ca146107e3578063dd62ed3e14610856578063e9dc1a951461088d578063f2fde38b146109c1575b341561013b57600080fd5b6101465b600080fd5b565b005b341561015357600080fd5b61016960043560243560443560643515156109e2565b604051901515815260200160405180910390f35b341561018857600080fd5b610190610a84565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156101cd5780820151818401525b6020016101b4565b50505050905090810190601f1680156101fa5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561021357600080fd5b610169600160a060020a0360043516602435610b2e565b604051901515815260200160405180910390f35b341561024957600080fd5b610251610be4565b60405190815260200160405180910390f35b341561026e57600080fd5b6102b460046024813581810190830135806020601f82018190048102016040519081016040528181529291906020840183838082843750949650610beb95505050505050565b604051600160a060020a03909116815260200160405180910390f35b34156102db57600080fd5b610169600160a060020a0360043581169060243516604435610c66565b604051901515815260200160405180910390f35b341561031757600080fd5b610190610cfa565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156101cd5780820151818401525b6020016101b4565b50505050905090810190601f1680156101fa5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156103a257600080fd5b610251610da4565b60405190815260200160405180910390f35b34156103c757600080fd5b610251610dab565b60405190815260200160405180910390f35b34156103ec57600080fd5b610190600160a060020a0360043516610db2565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156101cd5780820151818401525b6020016101b4565b50505050905090810190601f1680156101fa5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561048357600080fd5b610169600480359060446024803590810190830135806020601f82018190048102016040519081016040528181529291906020840183838082843750949650610e8395505050505050565b604051901515815260200160405180910390f35b34156104ed57600080fd5b610169600160a060020a0360043516610fd8565b604051901515815260200160405180910390f35b341561052057600080fd5b610251600160a060020a0360043516610fed565b60405190815260200160405180910390f35b341561055157600080fd5b61025160046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061100c95505050505050565b60405190815260200160405180910390f35b34156105b457600080fd5b61063c60046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061107d95505050505050565b60405191825260208201526040908101905180910390f35b341561065f57600080fd5b6101906111bf565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156101cd5780820151818401525b6020016101b4565b50505050905090810190601f1680156101fa5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156106ea57600080fd5b610169600160a060020a0360043516602435611269565b604051901515815260200160405180910390f35b6101696004356024356112e9565b604051901515815260200160405180910390f35b341561074257600080fd5b610169600480359060446024803590810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061136195505050505050565b604051901515815260200160405180910390f35b34156107ee57600080fd5b61016960048035600160a060020a03169060446024803590810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061157695505050505050565b604051901515815260200160405180910390f35b341561086157600080fd5b610251600160a060020a0360043581169060243516611671565b60405190815260200160405180910390f35b341561089857600080fd5b61016960046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965061169e95505050505050565b604051901515815260200160405180910390f35b34156109cc57600080fd5b610146600160a060020a03600435166119c2565b005b600160a060020a03331660009081526020819052604081205460ff161515610a0957600080fd5b7ff2c93682ed3c2de57c1a5b8d87987bc473b3c43950036e9b69234c19b24473ea610a3e60018787878763ffffffff611a4816565b604051808261010080838360005b83811015610a655780820151818401525b602001610a4c565b5050505090500191505060405180910390a15060015b5b949350505050565b610a8c612eec565b60038054600260001961010060018416150201909116046020601f82018190048102016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b235780601f10610af857610100808354040283529160200191610b23565b820191906000526020600020905b815481529060010190602001808311610b0657829003601f168201915b505050505090505b90565b6000600236604414610b3f57600080fd5b82158015610b705750600160a060020a033381166000908152600d6020908152604080832093881683529290522054155b1515610b7b57600080fd5b600160a060020a033381166000818152600d6020908152604080832094891680845294909152908190208690557f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259086905190815260200160405180910390a35b5b5092915050565b6001545b90565b6000600c826040518082805190602001908083835b60208310610c2057805182525b601f199092019160209182019101610c00565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a031690505b919050565b6007546000904211610c7757600080fd5b600336606414610c8657600080fd5b610c99600186868663ffffffff611ccf16565b1515610ca457600080fd5b83600160a060020a031685600160a060020a03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8560405190815260200160405180910390a3600191505b5b505b9392505050565b610d02612eec565b60048054600260001961010060018416150201909116046020601f82018190048102016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b235780601f10610af857610100808354040283529160200191610b23565b820191906000526020600020905b815481529060010190602001808311610b0657829003601f168201915b505050505090505b90565b6002545b90565b6007545b90565b610dba612eec565b6001600a01600083600160a060020a0316600160a060020a031681526020019081526020016000208054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610e765780601f10610e4b57610100808354040283529160200191610e76565b820191906000526020600020905b815481529060010190602001808311610e5957829003601f168201915b505050505090505b919050565b600160a060020a03331660009081526020819052604081205460ff161515610eaa57600080fd5b826009836040518082805190602001908083835b60208310610ede57805182525b601f199092019160209182019101610ebe565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020557fbab878453bea46cf2222f6dd20b3fa8d80dc6ca2b5d4f854173f07227a21e1a6828442604051808060200180602001858152602001848152602001838103835286818151815260200191508051906020019080838360005b83811015610f855780820151818401525b602001610f6c565b50505050905090810190601f168015610fb25780820380516001836020036101000a031916815260200191505b5092830390525060008152604090810193509150505180910390a15060015b5b92915050565b60006020819052908152604090205460ff1681565b600160a060020a0381166000908152600e60205260409020545b919050565b6000600f826040518082805190602001908083835b6020831061104157805182525b601f199092019160209182019101611021565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390205490505b919050565b6000806009846040518082805190602001908083835b602083106110b357805182525b601f199092019160209182019101611093565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600a856040518082805190602001908083835b6020831061111b57805182525b601f1990920191602091820191016110fb565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020846040518082805190602001908083835b6020831061117f57805182525b601f19909201916020918201910161115f565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054915091505b9250929050565b6111c7612eec565b60058054600260001961010060018416150201909116046020601f82018190048102016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b235780601f10610af857610100808354040283529160200191610b23565b820191906000526020600020905b815481529060010190602001808311610b0657829003601f168201915b505050505090505b90565b600754600090421161127a57600080fd5b61128c6001848463ffffffff611db416565b151561129757600080fd5b82600160a060020a031633600160a060020a03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405190815260200160405180910390a35060015b5b92915050565b60007f71e9115058326fa6f488debb25321c912f2e9df24f42a99f4a976822672ffee461131e6001858563ffffffff611e3c16565b604051808261012080838360005b838110156113455780820151818401525b60200161132c565b5050505090500191505060405180910390a15060015b92915050565b600160a060020a03331660009081526020819052604081205460ff16151561138857600080fd5b83600a846040518082805190602001908083835b602083106113bc57805182525b601f19909201916020918201910161139c565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020836040518082805190602001908083835b6020831061142057805182525b601f199092019160209182019101611400565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020557fbab878453bea46cf2222f6dd20b3fa8d80dc6ca2b5d4f854173f07227a21e1a683838642604051808060200180602001858152602001848152602001838103835287818151815260200191508051906020019080838360005b838110156114c85780820151818401525b6020016114af565b50505050905090810190601f1680156114f55780820380516001836020036101000a031916815260200191505b50838103825286818151815260200191508051906020019080838360005b8381101561152c5780820151818401525b602001611513565b50505050905090810190601f1680156115595780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390a15060015b5b9392505050565b600160a060020a03331660009081526020819052604081205460ff16151561159d57600080fd5b6115af6001848463ffffffff61233116565b15156115ba57600080fd5b82600160a060020a03167fce96c271d8db9db4a90e538f30d7ec5a63f116893c4636688d9ce1502b5cc93683426040518080602001838152602001828103825284818151815260200191508051906020019080838360005b8381101561162b5780820151818401525b602001611612565b50505050905090810190601f1680156116585780820380516001836020036101000a031916815260200191505b50935050505060405180910390a25060015b5b92915050565b600160a060020a038083166000908152600d60209081526040808320938516835292905220545b92915050565b600160a060020a03331660009081526020819052604081205460ff1615156116c557600080fd5b6116da6001878787878763ffffffff6128b616565b15156116e557600080fd5b600c866040518082805190602001908083835b6020831061171857805182525b601f1990920191602091820191016116f8565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a03167f270e8b0620bd7a85855d0ae9401e7fa30ea6319fbf06c05f38cad80875f1cc01876117f08660098a6040518082805190602001908083835b602083106117af57805182525b601f19909201916020918201910161178f565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020549063ffffffff612d4416565b600a896040518082805190602001908083835b6020831061182357805182525b601f199092019160209182019101611803565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020886040518082805190602001908083835b6020831061188757805182525b601f199092019160209182019101611867565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054428a604051808060200186815260200185815260200184815260200180602001838103835288818151815260200191508051906020019080838360005b838110156119115780820151818401525b6020016118f8565b50505050905090810190601f16801561193e5780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b838110156119755780820151818401525b60200161195c565b50505050905090810190601f1680156119a25780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390a25060015b5b95945050505050565b600160a060020a03331660009081526020819052604090205460ff1615156119e957600080fd5b600160a060020a03811660009081526020819052604090205460ff161515611a4357600160a060020a03808216600090815260208190526040808220805460ff199081166001179091553390931682529020805490911690555b5b5b50565b611a50612efe565b600160a060020a0330166000908152600d870160205260408120541580611a75575085155b15611a7f57600080fd5b600160a060020a0330166000908152600d88016020526040902054861115611aa657600080fd5b6005870154611abc90600163ffffffff612d4416565b600588015560008511611ad2576203f480611ad4565b845b9050611ae6428263ffffffff612d4416565b600588018054600090815260078a01602052604080822060019081019490945591548152200154611b1d908263ffffffff612d4416565b6005808901805460009081526007808c016020818152604080852060020197909755600160a060020a0330168452600d8e018152868420548554855291905285832060040155825482528482209093018a90558154815283812060060181905590548152918220015585670de0b6b3a7640000811515611b9957fe5b30600160a060020a03166000908152600d8a01602090815260408083205460058d018054855260078e01909352818420959094049093026008909401939093558254815281812060090181905582548152818120600a01879055915482529020600b01805460ff19169055821515600114611c1c57600087600601819055611c4d565b60058701546000908152600788016020526040902060020154611c45908263ffffffff612d4416565b876006018190555b5061010060405190810160409081526005808a0154808452600081815260078c01602081815285832060018101548289015260028101549688019690965260068e01546060880152600486015460808801529385015460a0870152600885015460c08701529190529052600a015460e082015291505b5b5b5095945050505050565b600160a060020a038084166000908152600c86016020908152604080832033909416835292905290812054611d0a818463ffffffff612d6016565b600160a060020a038087166000908152600c89016020908152604080832033851684528252808320949094559187168152600d89019091522054611d54908463ffffffff612d4416565b600160a060020a038086166000908152600d890160205260408082209390935590871681522054611d8b908463ffffffff612d6016565b600160a060020a0386166000908152600d88016020526040902055600191505b50949350505050565b600160a060020a0333166000908152600d84016020526040812054611ddf908363ffffffff612d6016565b600160a060020a033381166000908152600d870160205260408082209390935590851681522054611e16908363ffffffff612d4416565b600160a060020a0384166000908152600d860160205260409020555060015b9392505050565b611e44612f26565b600083815260078501602052604081206002015481908190819042901115611e6b57600080fd5b60008781526007890160205260409020600b015460ff1615611e8c57600080fd5b600087815260078901602052604081206008015411611eaa57600080fd5b60003411611eb757600080fd5b60008781526007890160205260409020600c01805460018101611eda8382612f4e565b916000526020600020900160005b503490555060008781526007890160205260409020600d01805460018101611f108382612f4e565b916000526020600020900160005b8890919091505550612005886007016000898152602001908152602001600020600d01805480602002602001604051908101604052809291908181526020018280548015611f8b57602002820191906000526020600020905b815481526020019060010190808311611f77575b50505050508960070160008a8152602001908152602001600020600c01805480602002602001604051908101604052809291908181526020018280548015611ff257602002820191906000526020600020905b815481526020019060010190808311611fde575b5050505050612d7990919063ffffffff16565b600088815260078a016020526040902060060181905586111561202757600080fd5b60008781526007890160205260409020600a8101546006909101546305f5e100909102908790031061205857600080fd5b60008781526007890160205260409020600a8101546004909101546120829163ffffffff612e2e16565b600088815260078a016020526040902060060154909450670de0b6b3a76400008115156120ab57fe5b04840292508234116120be5760006120c2565b8234035b915060008211156120fe57600160a060020a03331682156108fc0283604051600060405180830381858888f1935050505015156120fe57600080fd5b5b811561210b578261210d565b345b600088815260078a016020526040902060060154909150670de0b6b3a764000081151561213657fe5b048181151561214157fe5b60058a015460009081526007808c0160205260409091200154919004945061216f908263ffffffff612d4416565b600589015460009081526007808b016020908152604080842090920193909355600160a060020a0330168252600d8b0190925220546121b4908563ffffffff612d6016565b600160a060020a033081166000908152600d8b0160205260408082209390935533909116815220546121ec908563ffffffff612d4416565b600160a060020a0333166000908152600d8a01602090815260408083209390935560058b0154825260078b019052206004015461222f908563ffffffff612d6016565b6005890154600090815260078a01602052604090206004015561227b61225b348363ffffffff612d6016565b600089815260078b0160205260409020600801549063ffffffff612d6016565b60008881526007808b016020526040909120600881018390550154106122ba5760008781526007890160205260409020600b01805460ff191660011790555b6101206040519081016040908152888252602080830189905260008a81526007808d01808452848320600681015495870195909552606086018a90526080860187905260a086018890529084015460c0860152908b905290526008015460e08201524261010082015294505b505050509392505050565b6000600160a060020a038316151561234857600080fd5b600084600e01836040518082805190602001908083835b6020831061237f57805182525b601f19909201916020918201910161235f565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390205411156124dc5761244d84600e01836040518082805190602001908083835b602083106123f157805182525b601f1990920191602091820191016123d1565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a0385166000908152600d870160205260409020549063ffffffff612d4416565b600160a060020a0384166000908152600d860160205260408082209290925590600e8601908490518082805190602001908083835b602083106124a257805182525b601f199092019160209182019101612482565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020556128aa565b82600160a060020a031684600b01836040518082805190602001908083835b6020831061251b57805182525b601f1990920191602091820191016124fb565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a0316148015906125f05750600084600d01600086600b01856040518082805190602001908083835b6020831061259f57805182525b601f19909201916020918201910161257f565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a03168152602081019190915260400160002054115b156127e857600160a060020a0383166000908152600a850160205260409020828051612620929160200190612f78565b508284600b01836040518082805190602001908083835b6020831061265757805182525b601f199092019160209182019101612637565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055600d84016000600b8601846040518082805190602001908083835b602083106126f157805182525b601f1990920191602091820191016126d1565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a03908116825260208083019390935260409182016000908120549187168152600d8801938490528281209190915591908290600b8801908690518082805190602001908083835b6020831061279457805182525b601f199092019160209182019101612774565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a031681526020810191909152604001600020556128aa565b600160a060020a0383166000908152600a850160205260409020828051612813929160200190612f78565b508284600b01836040518082805190602001908083835b6020831061284a57805182525b601f19909201916020918201910161282a565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a03929092169190911790555b5b5060015b9392505050565b600080600080612936868b6008018a6040518082805190602001908083835b602083106117af57805182525b601f19909201916020918201910161178f565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020549063ffffffff612d4416565b925089600901886040518082805190602001908083835b6020831061296d57805182525b601f19909201916020918201910161294d565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020876040518082805190602001908083835b602083106129d157805182525b601f1990920191602091820191016129b1565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054915089600b01896040518082805190602001908083835b60208310612a3c57805182525b601f199092019160209182019101612a1c565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a0316905082158015612a88575081155b15612a9257600080fd5b89600f01856040518082805190602001908083835b60208310612ac757805182525b601f199092019160209182019101612aa7565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040519081900390205460ff16151560011415612b0e57600080fd5b8954612b32908390612b26908663ffffffff612d4416565b9063ffffffff612d4416565b8a55600160a060020a0330166000908152600d8b016020526040902054612b5f908363ffffffff612d4416565b600160a060020a033081166000908152600d8d01602052604090209190915581161515612c6f57612c00838b600e018b6040518082805190602001908083835b602083106117af57805182525b601f19909201916020918201910161178f565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020549063ffffffff612d4416565b8a600e018a6040518082805190602001908083835b60208310612c3557805182525b601f199092019160209182019101612c15565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902055612cb6565b600160a060020a0381166000908152600d8b016020526040902054612c9a908463ffffffff612d4416565b600160a060020a0382166000908152600d8c0160205260409020555b60018a600f01866040518082805190602001908083835b60208310612ced57805182525b601f199092019160209182019101612ccd565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805460ff1916911515919091179055600193505b5b5b5050509695505050505050565b6000828201612d5584821015612e4a565b8091505b5092915050565b6000612d6e83831115612e4a565b508082035b92915050565b600080600080600080612d8f6000885111612e4a565b612d9c6000895111612e4a565b612da588612e5a565b945060009350600092505b8651831015612e1357878381518110612dc557fe5b906020019060200201519150868381518110612ddd57fe5b906020019060200201519050612e0584612e00612dfa8585612ebd565b88612e2e565b612d44565b93505b600190920191612db0565b612e1f60008511612e4a565b8395505b505050505092915050565b6000808284811515612e3c57fe5b0490508091505b5092915050565b801515611a4357600080fd5b5b50565b6000806000612e6c6000855111612e4a565b5060009050805b8351811015612ea657612e9b82858381518110612e8c57fe5b90602001906020020151612d44565b91505b600101612e73565b612eb260008311612e4a565b8192505b5050919050565b6000828202612d55841580612edc5750838583811515612ed957fe5b04145b612e4a565b8091505b5092915050565b60206040519081016040526000815290565b6101006040519081016040526008815b6000815260200190600190039081612f0e5790505090565b6101206040519081016040526009815b6000815260200190600190039081612f0e5790505090565b815481835581811511612f7257600083815260209020612f72918101908301612ff7565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10612fb957805160ff1916838001178555612fe6565b82800160010185558215612fe6579182015b82811115612fe6578251825591602001919060010190612fcb565b5b50612ff3929150612ff7565b5090565b610b2b91905b80821115612ff35760008155600101612ffd565b5090565b905600a165627a7a7230582009d3c5a50d2c0c5e6f72020c9a6e22632b32e554f3270a9fb4682758b02fbce70029",\n  "networks": {\n    "17": {\n      "links": {},\n      "events": {\n        "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "owner",\n              "type": "address"\n            },\n            {\n              "indexed": true,\n              "name": "spender",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            }\n          ],\n          "name": "Approval",\n          "type": "event"\n        },\n        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "from",\n              "type": "address"\n            },\n            {\n              "indexed": true,\n              "name": "to",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            }\n          ],\n          "name": "Transfer",\n          "type": "event"\n        },\n        "0x270e8b0620bd7a85855d0ae9401e7fa30ea6319fbf06c05f38cad80875f1cc01": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "username",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "reservedValue",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            }\n          ],\n          "name": "Contribution",\n          "type": "event"\n        },\n        "0xce96c271d8db9db4a90e538f30d7ec5a63f116893c4636688d9ce1502b5cc936": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "username",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            }\n          ],\n          "name": "ContributorVerified",\n          "type": "event"\n        },\n        "0xbab878453bea46cf2222f6dd20b3fa8d80dc6ca2b5d4f854173f07227a21e1a6": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "reservedType",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            }\n          ],\n          "name": "RewardValueSet",\n          "type": "event"\n        },\n        "0xf2c93682ed3c2de57c1a5b8d87987bc473b3c43950036e9b69234c19b24473ea": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": false,\n              "name": "auctionDetails",\n              "type": "uint256[8]"\n            }\n          ],\n          "name": "Auction",\n          "type": "event"\n        },\n        "0x71e9115058326fa6f488debb25321c912f2e9df24f42a99f4a976822672ffee4": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": false,\n              "name": "bidDetails",\n              "type": "uint256[9]"\n            }\n          ],\n          "name": "AuctionBid",\n          "type": "event"\n        }\n      },\n      "updated_at": 1503000039729\n    }\n  },\n  "schema_version": "0.0.5",\n  "updated_at": 1503000039729\n}';

// const { abi } = JSON.parse(GitTokenContract)

var GitTokenAnalytics = function () {
  /**
   * GitToken Analytics Constructor Options
   * @param  {Object} options { mysql: { ...} }
   */
  function GitTokenAnalytics(options) {
    var _this = this;

    _classCallCheck(this, GitTokenAnalytics);

    this.listen();
    var web3Provider = options.web3Provider,
        mysqlOpts = options.mysqlOpts,
        contractAddress = options.contractAddress,
        abi = options.abi;


    this.saveContributionEvent = _saveContributionEvent2.default.bind(this);
    this.updateLeaderboard = _updateLeaderboard2.default.bind(this);
    this.updateTotalSupply = _updateTotalSupply2.default.bind(this);
    this.updateContributionFrequency = _updateContributionFrequency2.default.bind(this);
    this.updateSummaryStatistics = _updateSummaryStatistics2.default.bind(this);
    this.updateTokenInflationRate = _updateTokenInflationRate2.default.bind(this);
    this.updateInflationRateAverage = _updateInflationRateAverage2.default.bind(this);
    this.updateRewardTypeStats = _updateRewardTypeStats2.default.bind(this);
    this.updateUserTokenCreation = _updateUserTokenCreation2.default.bind(this);

    this.milestoneCreated = _milestoneCreated2.default.bind(this);
    this.milestoneCompleted = _milestoneCompleted2.default.bind(this);

    this.contractDetails = {};

    if (web3Provider && mysqlOpts && contractAddress && abi) {
      this.configure({ web3Provider: web3Provider, mysqlOpts: mysqlOpts, contractAddress: contractAddress, abi: abi }).then(function (configured) {
        console.log('GitToken Analytics Processor Configured');
        console.log(JSON.stringify(configured, null, 2));
        _this._watchContributionEvents();
      });
    } else {
      console.log('GitToken Analytics Processor listening for \'configure\' event.');
    }
  }

  _createClass(GitTokenAnalytics, [{
    key: 'configure',
    value: function configure(_ref) {
      var _this2 = this;

      var web3Provider = _ref.web3Provider,
          mysqlOpts = _ref.mysqlOpts,
          contractAddress = _ref.contractAddress,
          abi = _ref.abi;

      return new _bluebird2.default(function (resolve, reject) {
        _this2.establishMySqlConnection({ mysqlOpts: mysqlOpts }).then(function () {
          return _this2.configureWeb3Provider({ web3Provider: web3Provider });
        }).then(function () {
          return _this2.configureContract({ abi: abi, contractAddress: contractAddress });
        }).then(function (contract) {
          return _this2.getContractDetails();
        }).then(function () {
          // console.log('this.contractDetails', this.contractDetails)
          resolve({
            contractDetails: _this2.contractDetails
          });
        }).catch(function (error) {
          console.log('error', error);
          _this2.handleError({ error: error, method: 'configure' });
        });
      });
    }
  }, {
    key: 'establishMySqlConnection',
    value: function establishMySqlConnection(_ref2) {
      var _this3 = this;

      var mysqlOpts = _ref2.mysqlOpts;

      return new _bluebird2.default(function (resolve, reject) {
        try {
          _this3.mysql = _mysql2.default.createConnection(_extends({}, mysqlOpts));
          _this3.mysql.connect();
          resolve({ mysql: _this3.mysql });
        } catch (error) {
          _this3.handleError({ error: error, method: 'establishMySqlConnection' });
        }
      });
    }
  }, {
    key: 'query',
    value: function query(_ref3) {
      var _this4 = this;

      var queryString = _ref3.queryString,
          _ref3$queryObject = _ref3.queryObject,
          queryObject = _ref3$queryObject === undefined ? [] : _ref3$queryObject;

      return new _bluebird2.default(function (resolve, reject) {
        /* TODO: Check mysql docs for second param (queryObject) */
        _this4.mysql.query(queryString, function (error, result) {
          if (error) {
            _this4.handleError({ error: error, method: 'query' });
          }
          resolve(result);
        });
      });
    }
  }, {
    key: 'configureWeb3Provider',
    value: function configureWeb3Provider(_ref4) {
      var _this5 = this;

      var web3Provider = _ref4.web3Provider;

      return new _bluebird2.default(function (resolve, reject) {
        try {
          console.log('web3Provider', web3Provider);
          _this5.web3 = new _web2.default(new _web2.default.providers.HttpProvider(web3Provider));
          _this5.eth = (0, _bluebird.promisifyAll)(_this5.web3.eth);
          resolve({ web3: _this5.web3, eth: _this5.eth });
        } catch (error) {
          _this5.handleError({ error: error, method: 'configureWeb3Provider' });
        }
      });
    }
  }, {
    key: 'configureContract',
    value: function configureContract(_ref5) {
      var _this6 = this;

      var abi = _ref5.abi,
          contractAddress = _ref5.contractAddress;

      return new _bluebird2.default(function (resolve, reject) {
        _this6.contract = _this6.web3.eth.contract(abi).at(contractAddress);
        _bluebird2.default.resolve(Object.keys(_this6.contract)).map(function (method) {
          if (_this6.contract[method] && _this6.contract[method]['request']) {
            _this6.contract[method] = (0, _bluebird.promisifyAll)(_this6.contract[method]);
          }
        }).then(function () {
          resolve(_this6.contract);
        }).catch(function (error) {
          _this6.handleError({ error: error, method: 'configureContract' });
        });
      });
    }
  }, {
    key: '_watchContributionEvents',
    value: function _watchContributionEvents() {
      var _this7 = this;

      var events = this.contract.Contribution({}, { fromBlock: 0, toBlock: 'latest' });

      events.watch(function (error, result) {
        if (error) {
          _this7.handleError({ error: error, method: '_watchContributionEvents' });
        }
        console.log('_watchContributionEvents::result', result);
        _this7.saveContributionEvent({ event: result }).then(function (contribution) {
          process.send(JSON.stringify({
            event: 'new_contribution',
            data: contribution,
            message: 'New contribution received and saved.'
          }));
          return (0, _bluebird.join)(_this7.updateLeaderboard({ contribution: contribution }), _this7.updateTotalSupply({ contribution: contribution }), _this7.updateContributionFrequency({ contribution: contribution }), _this7.updateTokenInflationRate({ contribution: contribution }), _this7.updateInflationRateAverage({ contribution: contribution }), _this7.updateSummaryStatistics({ contribution: contribution }), _this7.updateRewardTypeStats({ contribution: contribution }), _this7.updateUserTokenCreation({ contribution: contribution }));
        }).then(function (data) {
          // console.log(JSON.stringify(data, null, 2))
          process.send(JSON.stringify({
            event: 'broadcast_contribution_data',
            message: 'Analytics updated on new contribution event.',
            data: data
          }));
        });
      });
    }
  }, {
    key: 'getContractDetails',
    value: function getContractDetails() {
      var _this8 = this;

      return new _bluebird2.default(function (resolve, reject) {
        (0, _bluebird.join)(_this8.contract.name.callAsync(), _this8.contract.symbol.callAsync(), _this8.contract.decimals.callAsync(), _this8.contract.organization.callAsync()).then(function (data) {
          // console.log('getContractDetails::data', data)
          try {
            _this8.contractDetails = {
              name: data[0],
              symbol: data[1],
              decimals: data[2].toNumber(),
              organization: data[3],
              address: _this8.contract.address
            };
            resolve({ contractDetails: _this8.contractDetails });
          } catch (error) {
            throw error;
          }
        }).catch(function (error) {
          console.log('contractDetails::error', error);
          _this8.handleError({ error: error, method: 'getContractDetails' });
        });
      });
    }
  }, {
    key: 'listen',
    value: function listen() {
      var _this9 = this;

      console.log('GitToken Analytics Listening on Separate Process: ', process.pid);
      process.on('message', function (msg) {
        // console.log('msg', msg)
        var _JSON$parse = JSON.parse(msg),
            event = _JSON$parse.event,
            data = _JSON$parse.data;

        switch (event) {
          case 'configure':
            var web3Provider = data.web3Provider,
                mysqlOpts = data.mysqlOpts,
                contractAddress = data.contractAddress,
                abi = data.abi;
            // console.log('listen::contractAddress, abi', contractAddress, abi)

            _this9.configure({
              web3Provider: web3Provider,
              mysqlOpts: mysqlOpts,
              contractAddress: contractAddress,
              abi: abi
            }).then(function (configured) {
              process.send(JSON.stringify({ event: event, data: configured, message: 'GitToken Analytics Processor Configured' }));
              _this9._watchContributionEvents();
            });
            break;
          case 'contract_details':
            _this9.getContractDetails().then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: 'Contract details retrieved.' }));
            });
            break;
          case 'get_contributions':
            _this9.query({ queryString: 'SELECT * FROM contributions;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_total_supply':
            _this9.query({ queryString: 'SELECT * FROM total_supply;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_leaderboard':
            _this9.query({ queryString: 'SELECT * FROM leaderboard;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_contribution_frequency':
            _this9.query({ queryString: 'SELECT * FROM contribution_frequency;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_token_inflation':
            _this9.query({ queryString: 'SELECT * FROM token_inflation;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_token_inflation_mean':
            _this9.query({ queryString: 'SELECT * FROM token_inflation_mean;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_user_token_creation':
            _this9.query({ queryString: 'SELECT * FROM user_token_creation;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_reward_type_stats':
            _this9.query({ queryString: 'SELECT * FROM reward_type_stats;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_summary_statistics':
            _this9.query({ queryString: 'SELECT * FROM summary_statistics;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'get_milestones':
            _this9.query({ queryString: 'SELECT * FROM milestones;' }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'milestone_created':
            _this9.milestoneCreated({ data: data }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          case 'milestone_closed':
            _this9.milestoneCompleted({ data: data }).then(function (result) {
              process.send(JSON.stringify({ event: event, data: result, message: event + ' data retrieved.' }));
            });
            break;
          default:
            process.send(JSON.stringify({
              message: 'Unhandled Analytics Event',
              data: [],
              event: 'error'
            }));
        }
      });
    }
  }, {
    key: 'handleError',
    value: function handleError(_ref6) {
      var error = _ref6.error,
          method = _ref6.method;

      /**
       * TODO Add switch case handler based on error codes, etc.
       * Determine when to send back message to parent process
       */
      console.log('handleError::method', method);
      console.log(error);
    }
  }]);

  return GitTokenAnalytics;
}();

exports.default = GitTokenAnalytics;